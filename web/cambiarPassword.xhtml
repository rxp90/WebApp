<!DOCTYPE html>
<ui:composition 
    template="/WEB-INF/templates/layout.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core">
    <ui:define name="content">
        <h:outputScript name="passwordMatcher.js" />

        <h:form id="formCambioPassword" rendered="#{userControllerBean.loggedIn}" class="form-horizontal">
            <div class="span9">
                <fieldset>
                    <legend>Cambiar contraseña</legend>

                    <h:panelGroup id="passwordPanel" layout="block" styleClass="#{(!passwordInput.valid) ?'control-group error':'control-group'}">
                        <h:outputLabel value="Contraseña actual" for="passwordInput" class="control-label"/>
                        <div class="controls">
                            <div class="input-prepend">
                                <span class="add-on"><i class="icon-asterisk"></i></span>         
                                <h:inputSecret binding="#{passwordInput}" value="#{registroBean.password}" id="passwordInput"/>
                            </div>
                            <h:message class="help-inline" for="passwordInput"/>
                        </div>
                    </h:panelGroup>
                    <h:panelGroup id="newPasswordPanel" layout="block" styleClass="#{(!passwordInput.valid) ?'control-group error':'control-group'}">
                        <h:outputLabel value="Nueva contraseña" for="newPasswordInput" class="control-label"/>
                        <div class="controls">
                            <div class="input-prepend">
                                <span class="add-on"><i class="icon-asterisk"></i></span>         
                                <h:inputSecret binding="#{newPasswordInput}" value="#{registroBean.password}" id="newPasswordInput"/>
                            </div>
                            <h:message class="help-inline" for="newPasswordInput"/>
                        </div>
                    </h:panelGroup>
                    <h:panelGroup id="verifyPasswordPanel" layout="block" styleClass="#{(!passwordInput.valid) ?'control-group error':'control-group'}">
                        <h:outputLabel value="Repita su nueva contraseña" for="verifyPasswordInput" class="control-label"/>
                        <div class="controls">
                            <div class="input-prepend">
                                <span class="add-on"><i class="icon-asterisk"></i></span>         
                                <h:inputSecret binding="#{verifyPasswordInput}" value="#{registroBean.password}" id="verifyPasswordInput"/>
                            </div>
                            <h:message class="help-inline" for="verifyPasswordInput"/>
                        </div>
                    </h:panelGroup>
                    <div class="btn-group pull-right">
                        <h:commandButton type="submit" id="submit" class="btn btn-large btn-primary" value="Crear cuenta">
                            <f:ajax render="formCambioPassword" execute="@form"/>
                        </h:commandButton>
                        <h:commandButton type="reset" class="btn btn-large" value="Limpiar"/>
                    </div>
                </fieldset>

                <div class="row">
                    <div class="span9">
                        <h:panelGroup layout="block" class="alert alert-error" rendered="#{registroBean.exito eq registroBean.ERROR_REGISTRO}">
                            <button type="button" class="close" data-dismiss="alert">×</button>
                            <h4 class="alert-heading">        
                                <h:outputText value="Error al registrar el usuario."/>
                            </h4>
                            <h:outputText value="Ocurrió un error al registrar el usuario en la base de datos."/>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="alert alert-success" rendered="#{registroBean.exito eq registroBean.REGISTRO_CORRECTO}">
                            <button type="button" class="close" data-dismiss="alert">×</button>
                            <h4 class="alert-heading">        
                                <h:outputText value="¡Hurra!"/>
                            </h4>
                            <h:outputText value="El usuario fue creado con éxito y se le envió un email con sus datos para iniciar sesión."/>
                        </h:panelGroup>
                        <h:panelGroup layout="block" class="alert alert-block" rendered="#{registroBean.exito eq registroBean.REGISTRO_CORRECTO_ERROR_ENVIAR_EMAIL}">
                            <button type="button" class="close" data-dismiss="alert">×</button>
                            <h4 class="alert-heading">        
                                <h:outputText value="Error al enviar email."/>
                            </h4>
                            <h:outputText value="El usuario fue creado correctamente pero hubo un error al enviarle un email con sus datos."/>
                        </h:panelGroup>
                    </div>
                </div>
            </div>
        </h:form>        
    </ui:define>
</ui:composition>
